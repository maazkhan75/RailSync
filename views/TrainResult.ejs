
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Trains</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Style+Script&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
    <h3 class="mb-4">Available Trains </h3>
    <form action="SearchTrain/PrintTicketNonStop"  method="POST" id="NonStopTrainForm">
        <table class="table table-dark table table-bordered table-hover"  id="NonStopTrainsTable">
        <caption>Non-Stop Trains</caption>
        
        <thead class=" table-dark">
            <th>#</th>
            <th>TrainID</th>
            <th>UpDown Status</th>
                <th>Dept Station</th>
                <th>Arrival Station</th>
                <th>Dept Time</th>
            <th>Arrival Time</th>
            <th>Ticket Type</th>
        </thead>
        
        <% Trains.forEach((i) => { %>
            <tr>
              <td>  <input class="form-check-input" type="radio" name="selectedTrainID" value="<%= i.TrainId %>"> </td>
                <input  type="hidden" name="TrackID" value="<%= i.TrackId %>">
                <td><%= i.TrainId %></td>
                <% if(i.UPStatus == 1) { %>
                    <td>Up</td>
                <% } else { %>
                    <td>Down</td>
                    <% } %>  

                    
                    <td ><%= i.DeptStation %></td>
                    <td><%= i.ArrivalStation %></td>
                <td><%= i.DeptTime %></td>
                <td><%= i.ArrivalTime %></td>
                <td>
                    
                    <table> 
                        <tr>
                            <td>Economy:</td>
                            <td><%= i.Economy%></td>
                        </tr>
                        
                        <tr>
                            <td>Bussiness:</td>
                            <td><%= i.BusinessClass%></td>
                        </tr>
        
                        <tr>
                            <td>First Class:</td>
                            <td><%=i.FirstClass%></td>
                        </tr>
        
                    </table>
                </td>
            </tr>
            <% }); %>
            
        </table>
    </form>
    <div class="col-sm-10">
        <select class="form-select" id="NonStopsClass" name="selectedClass">
            <option>Economy</option>
            <option>Bussiness</option>
            <option>First Class</option>
        </select>
    </div>
    <button class="btn btn-primary" onclick="bookTicket()">Check Seat</button>










    <h3 class="Heading">Trains with Stops</h3>
    <table id="TableTrainWithStops" class="table table-dark table table-bordered table-hover " >
        <tr>
            <th>TrainID</th>
            <th>TrackID</th>
            <th>UpDownStatus</th>
            <th>DeptStation</th>
            <th>ArrivalStation</th>
            <th>Dept Time</th>
            <th>Arrival Time</th>
            <th>Ticket Type</th>

        </tr>
        
        <% TrainsWithStops.forEach((i) => { %>
            <tr>
    <form action="SearchTrain/PrintTicketNonStop"  method="POST" id="<%= i.TrainId %>">
                <td><%= i.TrainId %></td>
                <td><%= i.TrackId %></td>
                <% if(i.UPStatus == 1) { %>
                    <td>Up</td>
                <% } else { %>
                    <td>Down</td>
                <% } %>
                <td><%= i.DeptStation %></td>
                <td><%= i.ArrivalStation %></td>
                <td><%= i.DeptTime %></td>
                <td><%= i.ArrivalTime %></td>
                <td>
                    
                    <table> 
                        <tr>
                            <td>Economy:</td>
                            <td><%= i.Economy%></td>
                        </tr>
                        
                        <tr>
                            <td>Bussiness:</td>
                            <td><%= i.BusinessClass%></td>
                        </tr>
        
                        <tr>
                            <td>First Class:</td>
                            <td><%=i.FirstClass%></td>
                        </tr>
        
                    </table>
                    <input  type="hidden" name="TrackID" value="<%= i.TrackId %>">
                    <input  type="hidden" name="selectedTrainID" value="<%= i.TrainId %>">
                    <td>
                        <select class="form-select" name="selectedClass">
                            <option>Economy</option>
                            <option>Bussiness</option>
                            <option>First Class</option>
                        </select>
                    </td>
                </td>
                <td>
                    <input type="submit" value="Check Seat" class="form-submit">
                </td>
    </form>
            </tr>
        <% }); %>
    </table>
    <!-- <select class="form-select" id="StopsClass" name="selectedClass">
        <option>Economy</option>
        <option>Bussiness</option>
        <option>First Class</option>
    </select>
    <button type="button" onclick="getDataAndCallApi()" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalCenter">
        Check Tickets
    </button> -->
    

</div>
  
  <!-- Modal -->
  <div class="modal fade bd-example-modal-lg" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class=" table table-dark table table-bordered table-hover" id="NonStopTicketsTable">
            <thead class=" table-dark">
                <th> Name</th>
                <th> TrainID</th>
                <th> Dept Station</th>
                <th> Arrival Station</th>
                <th> Class</th>
                <th> CarriageId</th>
                <th> Seat No</th>
                <th> Price</th>
            </thead>

            <tbody>

            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>

    function bookTicket() {
        var NonStopForm=document.getElementById('NonStopTrainForm');
        const selectedClass=document.getElementById("NonStopsClass");
        NonStopForm.appendChild(selectedClass);
        NonStopForm.submit();
          }
          

          function fetchTableData() {
    // Initialize an empty array to store the data from each row
    var rowData = [];

    // Get the table element by its ID
    var table = document.getElementById('TableTrainWithStops');

    // Check if the table exists
    if (table) {
        // Iterate over each row in the table
        for (var i = 1; i < table.rows.length; i++) { // Start from index 1 to skip the header row
            var row = table.rows[i]; // Get the current row

            // Initialize an object to store the data for the current row
            var rowDataItem = {};

            // Iterate over each cell in the row
            for (var j = 0; j < row.cells.length; j++) {
                var cell = row.cells[j]; // Get the current cell
                var cellData = cell.innerText.trim(); // Get the text content of the cell and remove leading/trailing whitespace
                var headerText = table.rows[0].cells[j].innerText.trim(); // Get the header text of the corresponding column

                // Add the cell data to the rowDataItem object with the corresponding header as the key
                rowDataItem[headerText] = cellData;
            }

            // Add the rowDataItem object to the rowData array
            rowData.push(rowDataItem);
        }
    }

    // Return the array containing data from each row
    return rowData;
}

function  DisplayNonStopTicketData(Ticket){
    console.log("Ticket array:", Ticket); // Log the Ticket array
    Ticket.forEach( i  => {
        var table = document.getElementById("NonStopTicketsTable");

// Create a new row
var newRow = table.insertRow();

// Insert cells into the new row and set their content
var TrainID = newRow.insertCell(0);
TrainID.innerHTML = i.TrainID;

    });
}

function getDataAndCallApi(){

    var jsonData = fetchTableData(); 
    let selectedClass=document.getElementById("StopsClass");
    //console.log(jsonData);
    console.log(selectedClass.value);
    console.log(selectedClass.name);
    let obj={
        selectedClass: selectedClass.value
    };
    jsonData.push(obj);
    // Convert the array of row data to JSON string
    
    var jsonString = JSON.stringify(jsonData);
    // console.log('JSON string is:');
    // console.log(jsonString);
    // console.log('Table data is:');
    // console.log(JSON.parse(jsonString));
    
    if(jsonData){   
        let option={
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body:jsonString
        }


        fetch('SearchTrain/PrintTicketsWithStopsDetails',option)
        .then(response => response.json())
        .catch(err=> console.log(err))
        .then(data=>{
            let SeatInfo=json.parse(data);
            console.log("Json got the data: ")
            console.log(data);

            var table = document.getElementById("NonStopTicketsTable");
            data.forEach( i  => {

// Create a new row
var newRow = table.insertRow();
alert(i.TrainID);
// Insert cells into the new row and set their content
var TrainID = newRow.insertCell(0);
TrainID.innerHTML = i.TrainID;

    });
        });

    }
    else{
        alert("Non stop trains available");
    }
    
}
    

</script>

</body>
</html>
